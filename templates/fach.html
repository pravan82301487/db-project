{% extends "base.html" %}
{% block content %}
<div class="header-section" style="margin-bottom: 20px;">
    <h2>ğŸ“– {{ fach.fachname }}</h2>
    <p>
        <strong>Lehrer:</strong> {{ fach.lehrer if fach.lehrer else '-' }} | 
        <strong>Gewichtung:</strong> {{ fach.fachgewichtung }} | 
        <strong>Semester:</strong> {{ fach.semester_name }}
    </p>
</div>

<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div>
            <h4 style="margin: 0 0 10px 0; color: #666;">Durchschnitt</h4>
            <p style="font-size: 2em; font-weight: bold; margin: 0; color: {{ 'green' if durchschnitt and durchschnitt >= 4 else 'red' }};">
                {{ durchschnitt if durchschnitt else '-' }}
            </p>
        </div>
        <div>
            <h4 style="margin: 0 0 10px 0; color: #666;">Pluspunkte (gerundet)</h4>
            <p style="font-size: 2em; font-weight: bold; margin: 0; color: {{ 'green' if total_pluspunkte and total_pluspunkte >= 0 else 'red' }};">
                {{ total_pluspunkte if total_pluspunkte is not none else '-' }}
            </p>
            {% if durchschnitt %}
            <small style="color: #666;">Gerundeter Schnitt: {{ (durchschnitt * 2)|round / 2 }}</small>
            {% endif %}
        </div>
        <div>
            <h4 style="margin: 0 0 10px 0; color: #666;">Anzahl Noten</h4>
            <p style="font-size: 2em; font-weight: bold; margin: 0;">
                {{ noten|length }}
            </p>
        </div>
    </div>
</div>

<div style="margin-bottom: 20px;">
    <a href="{{ url_for('add_note', fach_id=fach.id) }}" class="btn btn-success">
        â• Neue Note hinzufÃ¼gen
    </a>
    <form action="{{ url_for('delete_fach', fach_id=fach.id) }}" method="post" style="display: inline; margin-left: 10px;" onsubmit="return confirm('MÃ¶chtest du das Fach \'{{ fach.fachname }}\' wirklich lÃ¶schen? Alle Noten werden ebenfalls gelÃ¶scht!');">
        <button type="submit" class="btn btn-danger">
            ğŸ—‘ï¸ Fach lÃ¶schen
        </button>
    </form>
</div>

{% if noten %}
<table class="table table-striped" style="width: 100%;">
    <thead>
        <tr style="background-color: #f8f9fa;">
            <th>Datum</th>
            <th>Titel</th>
            <th>Note</th>
            <th>Gewichtung</th>
            <th>Aktion</th>
        </tr>
    </thead>
    <tbody>
        {% for note in noten %}
        <tr>
            <td>{{ note.datum }}</td>
            <td>{{ note.titel if note.titel else '-' }}</td>
            <td>
                <span style="font-weight: bold; color: {{ 'green' if note.notenwert >= 4 else 'red' }};">
                    {{ note.notenwert }}
                </span>
            </td>
            <td>{{ note.gewichtung }}</td>
            <td>
                <form action="{{ url_for('delete_note', note_id=note.id) }}" method="post" style="display: inline;" onsubmit="return confirm('MÃ¶chtest du diese Note wirklich lÃ¶schen?');">
                    <button type="submit" class="btn btn-xs btn-danger">
                        ğŸ—‘ï¸
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info" style="margin-top: 20px; padding: 20px; text-align: center;">
    <h4>Noch keine Noten vorhanden</h4>
    <p>FÃ¼ge deine erste Note hinzu, um deine Leistung zu tracken.</p>
    <a href="{{ url_for('add_note', fach_id=fach.id) }}" class="btn btn-success" style="margin-top: 10px;">
        â• Erste Note hinzufÃ¼gen
    </a>
</div>
{% endif %}

<div style="margin-top: 20px;">
    <a href="{{ url_for('semester_detail', semester_id=fach.semester_id) }}" class="btn btn-default">
        â† ZurÃ¼ck zum Semester
    </a>
    <a href="{{ url_for('semester_list') }}" class="btn btn-default">
        ğŸ  Zur Semester-Ãœbersicht
    </a>
</div>
{% endblock %}